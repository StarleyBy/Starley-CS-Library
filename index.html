<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical library</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <style>
        /* ==================== –ê–î–ê–ü–¢–ò–í–ù–´–ô –†–ê–ó–ú–ï–† –®–†–ò–§–¢–ê –ù–ê–ó–í–ê–ù–ò–ô ==================== */
        .book-card h3 {
            font-size: 1.1rem;
            line-height: 1.3;
            height: 2.6em; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ = 2 —Å—Ç—Ä–æ–∫–∏ */
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            text-overflow: ellipsis;
            margin-bottom: 0.5rem;
        }
        
        /* –î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π (50-80 —Å–∏–º–≤–æ–ª–æ–≤) */
        .book-card h3.long-title {
            font-size: 0.95rem;
            line-height: 1.25;
        }
        
        /* –î–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π (80+ —Å–∏–º–≤–æ–ª–æ–≤) */
        .book-card h3.very-long-title {
            font-size: 0.85rem;
            line-height: 1.2;
            -webkit-line-clamp: 3;
            height: 3.6em; /* 3 —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö */
        }
        
        /* ==================== –ù–ï–û–ù–û–í–´–ï –ò–ù–î–ò–ö–ê–¢–û–†–´ –í–ï–†–°–ò–ô ==================== */
        .version-badges {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 4px;
            z-index: 10;
        }
        
        .version-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: bold;
            letter-spacing: 1px;
            text-transform: uppercase;
            backdrop-filter: blur(4px);
            transition: all 0.3s ease;
            animation: neon-pulse 2.5s ease-in-out infinite;
        }
        
        /* RU Badge - –ö—Ä–∞—Å–Ω—ã–π –Ω–µ–æ–Ω */
        .version-badge.ru {
            background: rgba(231, 76, 60, 0.95);
            color: #fff;
            text-shadow: 
                0 0 5px #e74c3c,
                0 0 10px #e74c3c,
                0 0 15px rgba(231, 76, 60, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 0 10px rgba(231, 76, 60, 0.6),
                0 0 20px rgba(231, 76, 60, 0.3),
                inset 0 0 10px rgba(255, 255, 255, 0.1);
        }
        
        /* STAR Badge - –°–∏–Ω–∏–π –Ω–µ–æ–Ω */
        .version-badge.star {
            background: rgba(52, 152, 219, 0.95);
            color: #fff;
            text-shadow: 
                0 0 5px #3498db,
                0 0 10px #3498db,
                0 0 15px rgba(52, 152, 219, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 0 10px rgba(52, 152, 219, 0.6),
                0 0 20px rgba(52, 152, 219, 0.3),
                inset 0 0 10px rgba(255, 255, 255, 0.1);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –Ω–µ–æ–Ω–æ–≤–æ–≥–æ –ø—É–ª—å—Å–∞ */
        @keyframes neon-pulse {
            0%, 100% {
                opacity: 1;
                box-shadow: 
                    0 0 10px currentColor,
                    0 0 20px currentColor,
                    0 0 30px rgba(255, 255, 255, 0.2),
                    inset 0 0 10px rgba(255, 255, 255, 0.1);
            }
            50% {
                opacity: 0.9;
                box-shadow: 
                    0 0 5px currentColor,
                    0 0 10px currentColor,
                    0 0 15px rgba(255, 255, 255, 0.1),
                    inset 0 0 5px rgba(255, 255, 255, 0.05);
            }
        }
        
        /* –£–≤–µ–ª–∏—á–µ–Ω–∏–µ badge –ø—Ä–∏ hover –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É */
        .book-card:hover .version-badge {
            transform: scale(1.1);
        }
        
        /* ==================== TOOLTIP –î–õ–Ø –ü–û–õ–ù–´–• –ù–ê–ó–í–ê–ù–ò–ô ==================== */
        .book-card[data-full-title]:hover::after {
            content: attr(data-full-title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 10px 14px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            white-space: normal;
            max-width: 280px;
            width: max-content;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            margin-bottom: 10px;
            pointer-events: none;
            line-height: 1.4;
            animation: tooltip-fade-in 0.2s ease;
        }
        
        .book-card[data-full-title]:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 7px solid transparent;
            border-top-color: #2c3e50;
            margin-bottom: 3px;
            z-index: 1001;
            animation: tooltip-fade-in 0.2s ease;
        }
        
        @keyframes tooltip-fade-in {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(5px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        
        /* –£–±–∏—Ä–∞–µ–º tooltip –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 768px) {
            .book-card[data-full-title]:hover::after,
            .book-card[data-full-title]:hover::before {
                display: none;
            }
            
            .version-badge {
                font-size: 0.6rem;
                padding: 3px 7px;
            }
        }
        
        /* ==================== –£–õ–£–ß–®–ï–ù–ò–ï –ü–û–ó–ò–¶–ò–û–ù–ò–†–û–í–ê–ù–ò–Ø ==================== */
        .book-card {
            position: relative; /* –í–∞–∂–Ω–æ –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è badges */
        }
        
        .book-cover-container {
            position: relative; /* –í–∞–∂–Ω–æ –¥–ª—è badges –≤–Ω—É—Ç—Ä–∏ –æ–±–ª–æ–∂–∫–∏ */
        }
    </style>
</head>
<body>
    <header>
        <h1>üìö Medical library</h1>
        <nav>
            <a href="index.html">Library</a>
            <a href="editor.html">Editor</a>
            <a href="mdconvert.html">MD convert</a>
        </nav>
    </header>

    <main>
        <div class="search-box">
            <input type="text" id="search" placeholder="Search...">
        </div>

        <div id="library-container">
            <div class="loading">Library loading...</div>
        </div>
    </main>

    <footer>
        <p>Starley Library | 2026</p>
    </footer>

    <script src="assets/js/config.js?v=1.1"></script>
    <script src="assets/js/app.js?v=1.2"></script>
    
    <script>
        // ==================== –†–ê–°–®–ò–†–ï–ù–ò–ï –§–£–ù–ö–¶–ò–û–ù–ê–õ–ê APP.JS ====================
        // –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–Ω–∏–≥ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ (–µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å –≤ app.js)
        const originalCreateBookCard = window.createBookCard;
        
        // –ù–æ–≤–∞—è —É–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
        window.createBookCard = async function(book, categoryPath) {
            // –ï—Å–ª–∏ –µ—Å—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë
            let card;
            if (originalCreateBookCard) {
                card = await originalCreateBookCard(book, categoryPath);
            } else {
                // –ò–Ω–∞—á–µ —Å–æ–∑–¥–∞—ë–º –∫–∞—Ä—Ç–æ—á–∫—É —Å–∞–º–∏
                card = document.createElement('div');
                card.className = 'book-card';
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–Ω–∏–≥–∏
            const titleElement = card.querySelector('h3');
            if (titleElement) {
                const title = titleElement.textContent;
                const titleLength = title.length;
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞
                if (titleLength > 80) {
                    titleElement.classList.add('very-long-title');
                    // –î–æ–±–∞–≤–ª—è–µ–º tooltip –¥–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π
                    card.setAttribute('data-full-title', title);
                } else if (titleLength > 50) {
                    titleElement.classList.add('long-title');
                    // –î–æ–±–∞–≤–ª—è–µ–º tooltip –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π
                    card.setAttribute('data-full-title', title);
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤–µ—Ä—Å–∏–π –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
            const coverContainer = card.querySelector('.book-cover-container') || card.querySelector('img')?.parentElement;
            if (coverContainer && book.folder && categoryPath) {
                const versions = await checkAvailableVersions(categoryPath, book.folder);
                
                if (versions.russian || versions.starley) {
                    const badgesContainer = document.createElement('div');
                    badgesContainer.className = 'version-badges';
                    
                    if (versions.russian) {
                        const ruBadge = document.createElement('span');
                        ruBadge.className = 'version-badge ru';
                        ruBadge.textContent = 'RU';
                        badgesContainer.appendChild(ruBadge);
                    }
                    
                    if (versions.starley) {
                        const starBadge = document.createElement('span');
                        starBadge.className = 'version-badge star';
                        starBadge.textContent = 'STAR';
                        badgesContainer.appendChild(starBadge);
                    }
                    
                    coverContainer.style.position = 'relative';
                    coverContainer.appendChild(badgesContainer);
                }
            }
            
            return card;
        };
        
        // –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –≤–µ—Ä—Å–∏–π —á–µ—Ä–µ–∑ metadata
        async function checkAvailableVersions(categoryPath, bookFolder) {
            try {
                const metadataUrl = `${BASE_URL || ''}${categoryPath}/${bookFolder}/metadata.json`;
                const response = await fetch(metadataUrl);
                const bookData = (await response.json())[0];
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ metadata –≤–º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤
                return bookData.versions || { original: true, russian: false, starley: false };
            } catch (error) {
                console.warn(`Could not load versions for ${bookFolder}:`, error.message);
                return { original: true, russian: false, starley: false };
            }
        }
        
        // –ï—Å–ª–∏ app.js –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è, –∂–¥—ë–º —Å–æ–±—ã—Ç–∏—è DOMContentLoaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('‚úÖ Enhanced library features loaded (optimized version)');
            });
        } else {
            console.log('‚úÖ Enhanced library features loaded (optimized version)');
        }
    </script>
</body>
</html>
